<div id="createDialog" class="crudDialog">
    <form id="createForm" method="post">
        <div id="add" class="form-group">
            <label for="name">名称</label>
            <input id="name" type="text" class="form-control" name="name" maxlength="20"/>
        </div>
        <div id="update" class="form-group">
            <label for="description">描述</label>
            <input id="description" type="text" class="form-control" name="description" maxlength="50"/>
        </div>
        <div class="form-group">
            <label for="roleType">权限类型</label>
            <input id="roleType" type="text" class="form-control" name="roleType" maxlength="50"/>
        </div>
        <div class="form-group">
            <label for="treeDemo" class="active tree-lab">菜单选择</label>
            <ul id="treeDemo" class="ztree"></ul>
        </div>
        <div class="form-group text-right dialog-buttons">
            <a class="waves-effect waves-button" href="javascript:;" onclick="createSubmit();">保存</a>
            <a class="waves-effect waves-button" href="javascript:;" onclick="createDialog.close();">取消</a>
        </div>
    </form>

</div>

<script>

    //设置滚动条
    $('#treeDemo').mCustomScrollbar({
        theme: 'minimal-dark',
        scrollInertia: 100,
        axis: 'yx',
        mouseWheel: {
            enable: true,
            axis: 'y',
            preventDefault: true
        }
    });

    function getMenus(cb) {
        iGet('/api/menu', cb);
    }

    var zNodes = [
        {id: 1, pId: 0, name: "随意勾选 1", open: true},
        {id: 11, pId: 1, name: "随意勾选 1-1", open: true},
        {id: 111, pId: 11, name: "随意勾选 1-1-1"},
        {id: 112, pId: 11, name: "随意勾选 1-1-2"},
        {id: 12, pId: 1, name: "随意勾选 1-2", open: true},
        {id: 121, pId: 12, name: "随意勾选 1-2-1"},
        {id: 122, pId: 12, name: "随意勾选 1-2-2"},
        {id: 2, pId: 0, name: "随意勾选 2", checked: true, open: true},
        {id: 21, pId: 2, name: "随意勾选 2-1"},
        {id: 22, pId: 2, name: "随意勾选 2-2", open: true},
        {id: 221, pId: 22, name: "随意勾选 2-2-1", checked: true},
        {id: 222, pId: 22, name: "随意勾选 2-2-2"},
        {id: 23, pId: 2, name: "随意勾选 2-3"},
        {id: 24, pId: 2, name: "随意勾选 2-3"},
        {id: 25, pId: 2, name: "随意勾选 2-3"},
        {id: 26, pId: 2, name: "随意勾选 2-3"},
        {id: 27, pId: 2, name: "随意勾选 2-3"},
        {id: 28, pId: 2, name: "随意勾选 2-3"},
        {id: 29, pId: 2, name: "随意勾选 2-3"},
    ];


    <!--z_tree-->
    function BuildZTreeMenus(zNodes) {
        var menus = [];

        function onCheck(e, treeId, treeNode) {
            var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
            var nodes = treeObj.getCheckedNodes(true);
            menus.splice(0, menus.length);
            for (var i = 0; i < nodes.length; i++) {
                menus.push(nodes[i].id); //获取选中节点的值
            }
        }

        var setting = {
            check: {
                enable: true,
                chkboxType: {"Y": "ps", "N": "ps"}
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                onCheck: onCheck
            }
        };
        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
        return menus;
    }

    var menus = BuildZTreeMenus(zNodes);


    function getRole(id, fc) {
        iGet('/api/role/' + id, fc)
    }


    var id = 0;

    setTimeout(function () {
        if (location.href.indexOf('#') > 0) {
            id = location.href.split("#")[1];
        }
        //更新获取用户数据
        if (id != 0) {
            getRole(id, function (data) {
                console.log(data);
                var role = data.content;
                //设置input 此处没有用vue vue与inputmask有兼容性问题
                for (var p in role) {
                    $("input[name=" + p + "]").val(role[p]);
                }
                role.menuSet.forEach(function (menu) {

                })
            });
        }
        //去掉有值的input标题效果
        var inputs = $("#createForm input[type=text]");
        for (var i = 0; i < inputs.length; i++) {
            if ($(inputs[i]).val() != '') {
                $(inputs[i]).parent().find('label').addClass('active');
            }
        }
    }, 300)


    function createSubmit() {
        var data = {};
        $('#createForm').serializeArray().map(function (x) {
            data[x.name] = x.value;
        });
        var beforeSend = function () {
            if ($('#name').val() == '') {
                $('#name').focus();
                return false;
            }
            if ($('#roleType').val() == '') {
                $('#roleType').focus();
                return false;
            }
        }
        var success = function (result) {
            if (result.status != 'SUCCESS') {
                $.confirm({
                    theme: result.status == 'SUCCESS' ? 'light' : 'dark',
                    animation: 'rotateX',
                    closeAnimation: 'rotateX',
                    title: false,
                    content: result.msg,
                    buttons: {
                        confirm: {
                            text: '确认',
                            btnClass: 'waves-effect waves-button waves-light',
                        }
                    }
                });
            } else {
                createDialog.close();
                $table.bootstrapTable('refresh');
            }
        }
        var error = function (jqXHR, textStatus) {
            $.confirm({
                theme: 'dark',
                animation: 'rotateX',
                closeAnimation: 'rotateX',
                title: false,
                content: textStatus != 'canceled' ? '系统异常' : '请输入',
                buttons: {
                    confirm: {
                        text: '确认',
                        btnClass: 'waves-effect waves-button waves-light'
                    }
                }
            });
        }
        if (id == 0) {
            iPost('/api/role', data, beforeSend, success, error);
        } else {
            iPut('/api/role/' + id, data, beforeSend, success, error);
        }

    }
</script>